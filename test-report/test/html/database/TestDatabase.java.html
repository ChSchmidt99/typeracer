<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TestDatabase.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">typeracer</a> &gt; <a href="index.source.html" class="el_package">database</a> &gt; <span class="el_source">TestDatabase.java</span></div><h1>TestDatabase.java</h1><pre class="source lang-java linenums">package database;

import java.io.File;
import java.io.IOException;
import java.net.URISyntaxException;
import java.net.URL;
import java.nio.charset.StandardCharsets;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.nio.file.StandardOpenOption;
import java.util.HashMap;
import java.util.Map;
import java.util.Objects;
import java.util.Scanner;
import java.util.UUID;

/** implements test for the database interface. */
public class TestDatabase implements Database {

<span class="fc" id="L20">  Map&lt;String, String&gt; map = new HashMap&lt;&gt;();</span>
  private final String path;

<span class="fc" id="L23">  TestDatabase() throws URISyntaxException {</span>
<span class="fc" id="L24">    URL url = Objects.requireNonNull(this.getClass().getClassLoader().getResource(&quot;database.txt&quot;));</span>
<span class="fc" id="L25">    this.path = Paths.get(url.toURI()).toString();</span>
<span class="fc" id="L26">  }</span>

  /** select random piece of text from dictionary and use it in the game. */
  @Override
  public String getTextToType() {
<span class="nc" id="L31">    return &quot;Hallo Welt&quot;;</span>
  }

  /**
   * Creates new database.txt entry for user and returns unique ID.
   *
   * @param username name of user
   * @return userId
   */
  @Override
  public String registerUser(String username) throws IOException {
<span class="fc" id="L42">    UUID uuid = UUID.randomUUID();</span>
<span class="fc" id="L43">    String uuidAsString = uuid.toString();</span>
<span class="fc" id="L44">    Files.writeString(</span>
<span class="fc" id="L45">        Paths.get(path),</span>
<span class="fc" id="L46">        (username + &quot; &quot; + uuidAsString + System.lineSeparator()),</span>
        StandardCharsets.UTF_8,
        StandardOpenOption.APPEND);

<span class="fc" id="L50">    return uuidAsString;</span>
  }

  /**
   * Retrieves username by id.
   *
   * @param userId name of user
   * @return userId
   */
  @Override
  public String getUsername(String userId) throws IOException {
<span class="fc" id="L61">    File f = new File(path);</span>
<span class="fc" id="L62">    Scanner scanner = new Scanner(f, StandardCharsets.UTF_8);</span>

<span class="fc bfc" id="L64" title="All 2 branches covered.">    while (scanner.hasNextLine()) {</span>
<span class="fc" id="L65">      String[] columns = scanner.nextLine().split(&quot; &quot;);</span>
<span class="fc" id="L66">      map.put(columns[columns.length - 1], columns[0]);</span>
<span class="fc" id="L67">    }</span>

<span class="fc" id="L69">    String output = &quot;&quot;;</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">    for (Map.Entry&lt;String, String&gt; item : map.entrySet()) {</span>
<span class="fc" id="L71">      String key = item.getKey();</span>
<span class="fc" id="L72">      String value = item.getValue();</span>
<span class="fc bfc" id="L73" title="All 2 branches covered.">      if (key.equals(userId)) {</span>
<span class="fc" id="L74">        output = value;</span>
      }
<span class="fc" id="L76">    }</span>

    // TODO: Maybe find a nicer solution
<span class="pc bpc" id="L79" title="1 of 2 branches missed.">    if (output.equals(&quot;&quot;)) {</span>
<span class="nc" id="L80">      output = &quot;unknown&quot;;</span>
    }
<span class="fc" id="L82">    return output;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>